# tp-lab6-refactoring
# Лабораторная работа №6: Рефакторинг и Code Smells

## Цель работы
Научиться находить "запахи кода" (code smells) и применять рефакторинг для улучшения структуры программы без изменения её поведения.

## Исходный код
Исходный код содержал функцию `process_checkout()` длиной более 60 строк, которая выполняла множество различных операций:
- Разбор входных данных
- Валидацию
- Расчёт стоимости
- Применение скидок
- Расчёт налогов
- Формирование результата

## Обнаруженные проблемы (Code Smells)

### 1. Длинная функция (Long Method)
Функция `process_checkout()` содержала 60+ строк кода и выполняла слишком много различных операций, нарушая принцип единственной ответственности.

### 2. Магические числа (Magic Numbers)
В коде присутствовали "голые" числовые значения без объяснения:
- `0.10`, `0.20`, `0.05` - проценты скидок
- `0.21` - процент налога
- `50`, `10` - фиксированные скидки
- `200`, `100` - пороговые значения для скидок

### 3. Сложный условный оператор
Блок расчёта скидки содержал множество вложенных условий, что делало его трудным для понимания и модификации.

### 4. Нарушение принципа DRY
Проверка положительности значений `price` и `qty` использовала одинаковую логику, но не была вынесена в отдельную функцию.

### 5. Жёстко закодированные строки
Коды валют (`"USD"`) и купонов (`"SAVE10"`, `"SAVE20"`, `"VIP"`) были разбросаны по коду, что повышало вероятность ошибок при изменении.

### 6. Смешение уровней абстракции
Функция смешивала низкоуровневые операции (проверка типов) с высокоуровневой бизнес-логикой.

## Применённые рефакторинги

### 1. Разделение длинной функции
Исходная функция была разделена на несколько специализированных функций:
- `parse_request()` - извлечение данных
- `validate_request()` и `validate_items()` - валидация
- `calculate_subtotal()` - расчёт стоимости
- `calculate_discount()` - расчёт скидки
- `calculate_tax()` - расчёт налога
- `generate_order_id()` - генерация ID заказа
- `ensure_non_negative()` - гарантия неотрицательных значений

### 2. Вынесение констант
Все магические числа и строки были вынесены в именованные константы:
```python
DEFAULT_CURRENCY = "USD"
DEFAULT_TAX_RATE = 0.21
COUPON_SAVE10 = "SAVE10"
COUPON_SAVE10_RATE = 0.10
# и т.д.
